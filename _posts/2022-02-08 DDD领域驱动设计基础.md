---
layout: post
title:  "DDD领域驱动设计基础"
date:   2022-02-08 11:23:29 +0800
categories: DDD
---

领域驱动设计(简称 ddd)概念来源于2004年著名建模专家eric evans发表的他最具影响力的书籍:《domain-driven design –tackling complexity in the heart of software》(中文译名：领域驱动设计—软件核心复杂性应对之道)一书。，书中提出了“领域驱动设计(简称 ddd)”的概念。

 - 抽象服务层，流程不受影响，服务内部业务层变化不影响流程
 - 抽象基础设施层，防止第三方组件的变化

**领域模型**：为解决场景下的问题而形成的一套模型，然后使用这套模型来解决业务问题。 根据重复劳动经验我们会形成一套模式。领域模型也一样会形成一套模式，他包括：实体、值对象、模块、领域服务。

领域模型具有以下特点：

 - 领域模型是对具有某个边界的领域的一个抽象，反映了领域内用户业务需求的本质；领域模型是有边界的，只反应了我们在领域内所关注的部分；
 - 领域模型只反映具体业务，与任何技术实现无关；领域模型不止反映领域内具体的实体的概念，如书，人等，还反映领域中一些过程概念，如资金转账等；
 - 领域模型确保了我们的业务逻辑都在一个模型中，这样让我们的对软件的可维护性、可理解性及可重用性有很大的帮助；
 - 领域模型可以很容易帮开发人员将领域知识转化为软件构造；
 - 领域模型贯穿分析、设计以及整个开发过程；领域专家、设计人员和开发人员可以针对领域进行沟通交流，面向同一个领域共同分享，保证需求与实现一致性；
 - 建立正确的领域模型并不简单，需要领域专家、设计、开发人员积极沟通共同努力，然后才能使大家对领域的认识不断深入，从而不断细化和完善领域模型；
 - 领域模型可以使用图、代码或文字描述等方法来表示；
 - 领域模型是整个软件的核心，是软件中最有价值和最具竞争力的部分；设计足够精良且符合业务需求的领域模型能够更快速的响应需求变化；


#### 领域驱动设计中的一些基本概念：
##### 1．实体(entity)：
&nbsp;&nbsp;&nbsp;&nbsp;根据eric evans的定义，”一个由它的标识定义的对象叫做实体”。通常实体具备唯一id，能够被持久化，具有业务逻辑，对应现实世界业务对象。
&nbsp;&nbsp;&nbsp;&nbsp;实体一般和主要的业务/领域对象有一个直接的关系。一个实体的基本概念是一个持续抽象的生命，可以变化不同的状态和情形，但总是有相同的标识。
需要注意的是：
&nbsp;&nbsp;&nbsp;&nbsp;一些开发人员将实体当成了orm意义上的实体，而不是业务所有和业务定义的领域对象。在一些实现中采用了transaction script风格的架构，使用贫血的领域模型。这种认识上的混乱，在领域驱动架构中，不愿意在领域对象中加入业务逻辑而导致贫血的领域模型，同时还可能使混乱的服务对象激增。
##### 2．值对象(value object)
&nbsp;&nbsp;&nbsp;&nbsp;值对象的定义是：描述事物的对象；更准确的说，一个没有概念上标识符描述一个领域方面的对象。这些对象是用来表示临时的事物，或者可以认为值对象是实体的属性，这些属性没有特性标识但同时表达了领域中某类含义的概念。
&nbsp;&nbsp;&nbsp;&nbsp;通常值对象不具有唯一id，由对象的属性描述，可以用来传递参数或对实体进行补充描述。实体具有唯一标识，而值对象没有唯一标识，这是实体和值对象间的最大不同。
##### 3．聚合及聚合根(aggregate、aggregate root)：
&nbsp;&nbsp;&nbsp;&nbsp;聚合是用来定义领域对象所有权和边界的领域模式。聚合的作用是帮助简化模型对象间的关系。聚合，它通过定义对象之间清晰的所属关系和边界来实现领域模型的内聚，并避免了错综复杂的难以维护的对象关系网的形成。聚合定义了一组具有内聚关系的相关对象的集合，我们把聚合看作是一个修改数据的单元。
&nbsp;&nbsp;&nbsp;&nbsp;划分aggregation是对领域模型的进一步深化，aggregation能阐释领域模型内部对象之间的深层关联．对aggregation的划分会直接映射到程序结构上．比如：ｄｄｄ推荐按aggregation设计model的子包．每个aggregation配备一个repository.aggregation内部的非root对象是通过导航获得的．        
&nbsp;&nbsp;&nbsp;&nbsp;一个聚合是一组相关的被视为整体的对象。每个聚合都有一个根对象（聚合根实体），从外部访问只能通过这个对象。根实体对象有组成聚合所有对象的引用，但是外部对象只能引用根对象实体。 只有聚合根才能使用仓储库直接查询，其它的只能通过相关的聚合访问。如果根实体被删除，聚合内部的其它对象也将被删除。
&nbsp;&nbsp;&nbsp;&nbsp;通常，我们把聚合组织到一个文件夹或一个包中。每一个聚集对应一个包，并且每个聚集成员包括实体、值对象，domain事件，仓储接口和其它工厂对象。
##### 4．工厂(factories)：
&nbsp;&nbsp;&nbsp;&nbsp;工厂用来封装创建一个复杂对象尤其是聚合时所需的知识，作用是将创建对象的细节隐藏起来。客户传递给工厂一些简单的参数，然后工厂可以在内部创建出一个复杂的领域对象然后返回给客户。当创建 实体和值对象复杂时建议使用工厂模式。
##### 5．仓储（repositories）：
&nbsp;&nbsp;&nbsp;&nbsp;仓储是用来管理实体的集合。
&nbsp;&nbsp;&nbsp;&nbsp;仓储里面存放的对象一定是聚合，原因是domain是以聚合的概念来划分边界的；聚合作为一个整体概念，要么一起被取出来，要么一起被删除。外部访问不会单独对某个聚合内的子对象进行单独操作。因此，我们只对聚合设计仓储。仓储还有一个重要的特征就是分为仓储定义部分和仓储实现部分，我们在领域模型中定义仓储的接口，而在基础设施层实现具体的仓储。也符合按照接口分离模式在领域层定义仓储库接口的原则。
&nbsp;&nbsp;&nbsp;&nbsp; dao和repository在领域驱动设计中都很重要。dao是面向数据访问的，是关系型数据库和应用之间的契约。
 &nbsp;&nbsp;&nbsp;&nbsp;repository：位于领域层，面向aggregation root。repository是一个独立的抽象，使用领域的通用语言，它与dao进行交互，并使用领域理解的语言提供对领域模型的数据访问服务的“业务接口”。
 ##### 6．服务（services）：
 &nbsp;&nbsp;&nbsp;&nbsp; 服务这个词在服务模式中是这么定义的：服务提供的操作是它提供给使用它的客户端，并突出领域对象的关系。
&nbsp;&nbsp;&nbsp;&nbsp; 所有的service只负责协调并委派业务逻辑给领域对象进行处理，其本身并真正实现业务逻辑，绝大部分的业务逻辑都由领域对象承载和实现了。
&nbsp;&nbsp;&nbsp;&nbsp; service可与多种组件进行交互，这些组件包括：其他的service、领域对象和repository 或 dao。

服务的3个特征:
- 服务执行的操作涉及一个领域概念，这个领域概念通常不属于一个实体或者值对象
- 被执行的操作涉及到领域中其它的对象
- 操作时无状态的

##### 7．domain事件
 &nbsp;&nbsp;&nbsp;&nbsp; 企业级应用程序事件大致可以分为三类：系统事件、应用事件和领域事件。领域事件的触发点在领域模型（domain model）中。它的作用是将领域对象从对repository或service的依赖中解脱出来，避免让领域对象对这些设施产生直接依赖。它的做法就是当领域对象的业务方法需要依赖到这些对象时就发出一个事件，这个事件会被相应的对象监听到并做出处理。
 &nbsp;&nbsp;&nbsp;&nbsp; 通过使用领域事件，我们可以实现领域模型对象状态的异步更新、外部系统接口的委托调用，以及通过事件派发机制实现系统集成。另外，领域事件本身具有自描述性。它不仅能够表述系统发生了什么事情，而且还能够描述发生事件的动机。
 
 ##### 8．DTO
 &nbsp;&nbsp;&nbsp;&nbsp; dto：datatransfer object（数据传输对象）。dto在设计之初的主要考量是以粗粒度的数据结构减少网络通信并简化调用接口。